{% extends "view/rootpage.html" %}
{% block title %}Speaker Details for {{t.name}}{% endblock %}

{% block head_extra %}

<script type="text/javascript">

$(document).ready(function () {
	jQuery("#link1").click(function(){
		bind1('1');
	});

	jQuery("#link2").click(function(){
		bind1('2');
	});


	jQuery("#useMe1").click(function(){
		$('#sp1Key').val('{{user.key.id()}}');
		bind1('1');
	});

	jQuery("#clear1").click(function(){
		clear1('1');
	});

	jQuery("#clear2").click(function(){
		clear1('2');
	});

});

function bind1(spk) {
	var id = $('#sp' + spk + 'Key').val();

	$('#sp' + spk + 'Key').prop('disabled', true);
	$('#useMe' + spk).prop('disabled', true);
	$('#link' + spk).prop('disabled', true);


	$.get("../checkID?id=" + id, function(data, status){

		var d = JSON.parse(data);
		problem = d['problem'];

		if (problem == 'None') {
			$('#link' + spk + 'error').prop('hidden', true);
			$('#sp' + spk + 'Name').prop('disabled', true);
			$('#sp' + spk + 'Name').val(d['name']);

			$('#useMe' + spk).hide();
			$('#link' + spk).hide();
			$('#clear' + spk).show();

			$('#link' + spk + 'Success').show();
		}

		else {
			$('#sp' + spk + 'Key').prop('disabled', false);
			$('#useMe' + spk).prop('disabled', false);
			$('#link' + spk).prop('disabled', false);

			$('#link' + spk + 'error').text(problem);
			$('#link' + spk + 'error').prop('hidden', false);
		}

		});
}

function clear1(spk){
	$('#link' + spk + 'Success').hide();
	$('#sp' + spk + 'Key').prop('disabled', false);
	$('#useMe' + spk).prop('disabled', false);
	$('#link' + spk).prop('disabled', false);
	$('#sp' + spk + 'Name').prop('disabled', false);
	$('#sp' + spk + 'Name').val('');
	$('#sp' + spk + 'Key').val('');
	$('#clear' + spk).hide();
	$('#useMe' + spk).show();
	$('#link' + spk).show();
}
</script>

{% endblock %}

{% block content %}
	<h2><i class="fa fa-keyboard-o"></i> Update Speaker Details</h2>

	{% if user %}

			{% if form.errors %}
			    <ul class="errors">
			        {% for field_name, field_errors in form.errors|dictsort if field_errors %}
			            {% for error in field_errors %}
			                <li>{{ form[field_name].label }}: {{ error }}</li>
			            {% endfor %}
			        {% endfor %}
			    </ul>
			{% endif %}

			<form role="form" action="/reg/update_open_details?t={{t.key.id()}}" method="post">
				<div class="form-group col-md-12">
						<label for="teamName">Your Team Name</label>
					{{form.teamName(class="form-control", placeholder="The best ones contain in-jokes")}}
				</div>

<div class="alert alert-warning col-md-12">
					<h3>Contact Information</h3>

					<p>
						This information is visible to the organisers of of {{t.name}}. It comes
						from your Tournatrack profile, you may change this information at any time in
					your <a href="/update_profile" target="_blank">profile settings</a>.
					</p>

					<div class="form-group col-md-12">
						<label for="name">Name</label>
						<input class="form-control" disabled value="{{user.full_name}}" />
					</div>

					<div class="form-group col-md-6">
						<label for="phone">Telephone Number</label>
						<input class="form-control" disabled value="{{user.phone}}" />
					</div>

					<div class="form-group col-md-6">
						<label for="phone">Email</label>
						<input class="form-control" disabled value="{{user.preferredEmail()}}" />
					</div>

				</div>


						<h3>Speaker Details</h3>
						<p>
							For each speaker you must provide either their name, or their
							Tournatrack DebaterID. If you use their DebaterID, this tournament
							will be linked to their account, and  they will receive updates from
							the tournament convenors. You can find your DebaterID at the top of your
							Debater CV.
						</p>


					<div class="panel panel-default">

						<div class="panel-heading">
							<span class="glyphicon glyphicon-user "></span>&nbsp;Speaker 1
						</div>

						<div class="panel-body">

							<div class="col-sm-6">
								<h3>Link DebaterID</h3>
								<p>Automatically link a Tournatrack user to this speaker. It will be
								visible in their account.</p>

								<div class="alert alert-danger" id="link1error" hidden="true">

								</div>

								<input class="form-control" placeholder="DebaterID" id="sp1Key" />
								<div class="alert alert-success" id="link1Success" style="display: none;">
									The DebaterID was successfully linked. Save your changes below.
								</div>
								<button class="btn btn-info" type="button" id="link1">Link DebaterID</button>
								<button class="btn btn-info" type="button" id="useMe1">Use My DebaterID</button>
								<button class="btn btn-danger" type="button" id="clear1" style="display: none;">Unlink DebaterID</button>
							</div>

							<div class="col-sm-6">
								<h3>Manual Entry</h3>
								<p>Or: Manually provide the details of a speaker. They will not receive
									updates about the tournament.
								</p>

								<div class="form-group">
									<label for="sp1Name">Full Name</label>
									{{form.sp1Name(class="form-control", id="sp1Name", placeholder="Speaker 1")}}
								</div>

							</div>
					</div>

					<div class="panel-footer" style="padding-bottom: 2em;">
						<div class="form-group">
							<div class="col-sm-2">
								<div class="checkbox">
									<label>
										{{form.sp1Novice()}} Novice
									</label>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="checkbox">
									<label>
										{{form.sp1ESL()}} ESL
									</label>
								</div>
							</div>
						</div>
					</div>

				</div>

<div class="panel panel-default">

	<div class="panel-heading">
		<span class="glyphicon glyphicon-user "></span>&nbsp;Speaker 2
	</div>

	<div class="panel-body">

		<div class="col-sm-6">
			<h3>Link DebaterID</h3>
			<p>Automatically link a Tournatrack user to this speaker. It will be
			visible in their account.</p>

			<div class="alert alert-danger" id="link2error" hidden="true">

			</div>

			<input class="form-control" placeholder="DebaterID" id="sp2Key" />
			<div class="alert alert-success" id="link2Success" style="display: none;">
				The DebaterID was successfully linked. Save your changes below.
			</div>
			<button class="btn btn-info" type="button" id="link2">Link DebaterID</button>
			<button class="btn btn-danger" type="button" id="clear2" style="display: none;">Unlink DebaterID</button>
		</div>

		<div class="col-sm-6">
			<h3>Manual Entry</h3>
			<p>Or: Manually provide the details of a speaker. They will not receive
				updates about the tournament.
			</p>

			<div class="form-group">
				<label for="sp2Name">Full Name</label>
				{{form.sp2Name(class="form-control", id="sp2Name", placeholder="Speaker 2")}}
			</div>

		</div>
</div>

<div class="panel-footer" style="padding-bottom: 2em;">
	<div class="form-group">
		<div class="col-sm-2">
			<div class="checkbox">
				<label>
					{{form.sp2Novice()}} Novice
				</label>
			</div>
		</div>
		<div class="col-sm-2">
			<div class="checkbox">
				<label>
					{{form.sp2ESL()}} ESL
				</label>
			</div>
		</div>
	</div>
</div>

</div>

			   	<button type="submit" class="btn btn-primary btn-lg">Save Changes</button>
			</form>

	{% else %}

		You need to <a href="{{login}}">sign in</a> with your Google account to register for this tournament.

	{% endif %}


{% endblock %}
